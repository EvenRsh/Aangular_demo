<!DOCTYPE html>
<html ng-app="newsApp">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title></title>
	</head>
	<link rel="stylesheet" href="css/weui.css" />
	<link rel="stylesheet" href="css/swiper.css" />

	<body>
		<div ui-view=""></div>
	</body>
	<script src="js/angular.js"></script>
	<script src="js/angular-ui-router.js"></script>
	<script src="js/swiper.js"></script>
	<script>
		var app = angular.module('newsApp', ['routers', 'directives', 'controllers']);
		var routers = angular.module('routers', ['ui.router']);
		routers.config(['$stateProvider', '$urlRouterProvider', function($stateProvider, $urlRouterProvider) {
			$stateProvider.state('index', {
				url: '/index',
				controller: 'indexCtrl',
				templateUrl: 'template/index.html'
			}).state('index.recommend', {
				url: '/recommend/:id',
				controller: 'recommendCtrl',
				templateUrl: 'template/recommend.html'
			}).state('index.hot', {
				url: '/hot/:id',
				//controller:'indexCtrl',
				templateUrl: 'template/hot.html'
			}).state('index.entertainment', {
				url: '/entertainment/:id',
				//controller:'indexCtrl',
				templateUrl: 'template/entertainment.html'
			}).state('search', {
				url: '/search',
				controller: 'homeCtrl',
				templateUrl: 'template/search.html'
			}).state('detail', {
				url: '/detail/:id',
				controller: 'detailCtrl',
				templateUrl: 'template/detail.html'
			}).state('insert', {
				url: '/insert',
				controller: 'insertCtrl',
				templateUrl: 'template/insert.html'
			})

			$urlRouterProvider.when('', '/index/recommend')
		}])

		var controllers = angular.module('controllers', []);
		controllers.controller('indexCtrl', ['$scope', function($scope) {
			$scope.tabs = 1;
			$scope.changeTab = function(tabs) {
				$scope.tabs = tabs
			}
		}]).controller('recommendCtrl', ['$scope', '$http', '$state', function($scope, $http, $state) {
			$scope.isSearch = false
			$scope.search = function() {
				$scope.isSearch = true
			}
			$scope.cancel = function() {
				$scope.searchName = ''
				$scope.isSearch = false
			}
			$scope.isShowActionSheet = false
			$scope.showActionSheet = function() {
				$scope.isShowActionSheet = true
			}
			$scope.hideActionSheet = function() {
				$scope.isShowActionSheet = false
			}
			$scope.searchName = '';
			$scope.isLoadMore = false
			$scope.page = 1;
			$scope.news = [];
			$scope.sort = true;
			$scope.loadMore = function() {
				$scope.isLoadMore = false
				//$http.get('http://localhost:81/news/php/index.php/news_api/show_detail_by_channel_id', {
				$http.get('js/show_list.json', {
				params: {
						page: $scope.page++,
						channel_id: $state.params.id
					}
				}).success(function(data) {
					console.log(data);
					$scope.news = $scope.news.concat(data.news_list)
					$scope.isLoadMore = true
				})
			}
			$scope.loadMore();
		}]).controller('detailCtrl', ['$scope', '$http', '$state', '$sce', function($scope, $http, $state, $sce) {
			console.log($state.params.id);
			$http.get('js/show_detail.json', {
				params: {
					id: $state.params.id
				}
			}).success(function(data) {
				console.log(data)
					//$scope.html = $sce.trustAsHtml(data.news_list[0].text)
				$scope.new = data.news_list[0]
			})
			$scope.isGallery = false;
			$scope.imgUrl = '';
			$scope.gallery = function(imgUrl) {
				$scope.isGallery = true
				$scope.imgUrl = imgUrl;
			}
		}]).controller('insertCtrl', ['$scope', '$http', function($scope, $http) {
			$scope.submit = function(){
				console.log($scope.title)
				console.log($scope.text)
				$http.get('http://localhost:81/news/php/index.php/news_api/insert_news',{
					params:{
						title:$scope.title,
						text:$scope.text
					}
				}).success(function(data){
					console.log(data)
				})
			}
		}])

		var directives = angular.module('directives', []);
		directives.directive('wheader', function() {
			return {
				templateUrl: 'directive/wheader.html'
			}
		}).directive('wsearch', function() {
			return {
				templateUrl: 'directive/wsearch.html'
			}
		}).directive('wpanel', function() {
			return {
				templateUrl: 'directive/wpanel.html'
			}
		}).directive('wactionsheet', function() {
			return {
				templateUrl: 'directive/wactionsheet.html'
			}
		}).directive('wcarousel', function() {
			return {
				templateUrl: 'directive/wcarousel.html',
				link: function(scope, ele, attr) {
					var swiper = new Swiper('.swiper-container', {
						pagination: '.swiper-pagination',
						paginationClickable: true
					});
				}
			}
		})
	</script>

</html>