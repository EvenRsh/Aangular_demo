<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<style type="text/css">
			body,
			html {
				width: 100%;
				height: 100%;
				margin: 0;
				font-family: "微软雅黑";
			}
			
			#l-map {
				height: 300px;
				width: 100%;
			}
			
			#r-result {
				width: 100%;
			}
		</style>
		<title></title>
	</head>

	<body id="demo">
		<div id="l-map"></div>
		<div id="r-result"></div>
		<input v-model="busNum" />
		<button @click="busSearch()">查询</button>
	</body>
	<script src="js/vue.js"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=yA2OiAD3q3ntTH1TQF5IWaSg598p3bQX"></script>
	<script>
		new Vue({
			el: '#demo',
			data: {
				busNum: '',
				busline: '',
			},
			methods: {
				busSearch: function() {
					//var busName = 331;
					this.busline.getBusList(this.busNum);
				}
			},
			ready: function() {
				var geolocation = new BMap.Geolocation();
				var map = new BMap.Map("l-map");
				geolocation.getCurrentPosition(function(data) {
						console.log(data)
						map.centerAndZoom(new BMap.Point(data.longitude, data.latitude), 15);
						var point = new BMap.Point(data.longitude, data.latitude);
						var marker = new BMap.Marker(point);
						map.addOverlay(marker);
						marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
						//map.centerAndZoom(point, 15);
					}, function(err) {})
					// 百度地图API功能
					/*var map = new BMap.Map("l-map"); // 创建Map实例
					map.centerAndZoom(new BMap.Point(116.404, 39.915), 12);*/
				var self = this;
				this.busline = new BMap.BusLineSearch(map, {
					renderOptions: {
						map: map,
						panel: "r-result"
					},
					onGetBusListComplete: function(result) {
						if(result) {
							var fstLine = result.getBusListItem(0); //获取第一个公交列表显示到map上
							self.busline.getBusLine(fstLine);
						}
					}
				});

				/*setTimeout(function() {
					busSearch();
				}, 1500);*/

			}
		})
	</script>

</html>